//this function will handle client communication with the server
var clientSetup = function() {
		//create() is moved here to make sure nothing is created before uniq id assignation
		create();

<% if @players %>
  <% @players.uniq.each do |x| %>
      spawnPlayer('<%= x %>');
  <% end %>
<% end %>
  playersList[myId] = player;
}

var goleft = function(i) {
    playersList[i].dude.body.x -= 5;
    playersList[i].dude.animations.play('left');
  }
var goright = function(i) {
    playersList[i].dude.body.x += 5;
    playersList[i].dude.animations.play('right');
  }
var goup = function(i) {
    playersList[i].dude.body.y -= 5;
    playersList[i].dude.animations.play('up')
  }
var godown = function(i) {
    playersList[i].dude.body.y += 5;
    playersList[i].dude.animations.play('down')
  }
var attack = function(i) {
    playersList[i].dude.animations.stop();
  }

var killMe = function(i) {
        console.log('KILL');
	      playersList[i].alive = false;
	      playersList[i].kill();
}

var width = $('#gamescreen').innerWidth() - 50;
var height = $('#gamescreen').innerHeight();
var game = new Phaser.Game(width, height, Phaser.AUTO, 'gamescreen', { preload: preload, loadUpdate: loadUpdate, create: clientSetup, update: update, render: render });

function preload() {

  this.preloadBar = game.add.graphics(0, 50);
  this.preloadBar.lineStyle(3, 0xffffff, 1);
  this.preloadBar.moveTo(0, 0);
  this.preloadBar.lineTo(game.width, 0);
  this.preloadBar.scale.x = 0; // set the bar to the beginning position

    game.load.tilemap('level',"assets/tileset/baseLevel.json",null, Phaser.Tilemap.TILED_JSON);
    game.load.image('tiles',"assets/tileset/hyptosis_tile-art-batch-1.png");
    game.load.spritesheet('dude',"assets/tileset/brandonTile.png",14,21);
}

function loadUpdate() {
  // every frame during loading, set the scale.x of the bar to the progress (an integer between 0
  // and 100) divided by 100 to give a float between 0 and 1
  this.preloadBar.scale.x = game.load.progress * 0.01;
}